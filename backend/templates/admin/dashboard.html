{% extends "base.html" %}
{% block content %}
<h2>Dashboard</h2>
<div class="row">
  <div class="col">
    <div class="card">
      <div class="muted">Total Users</div>
      <div style="font-size:28px; font-weight:700">{{ stats.total_users }}</div>
    </div>
  </div>
  <div class="col">
    <div class="card">
      <div class="muted">Active Premium</div>
      <div style="font-size:28px; font-weight:700">{{ stats.active_premium }}</div>
    </div>
  </div>
  <div class="col">
    <div class="card">
      <div class="muted">Expiring 1d</div>
      <div style="font-size:28px; font-weight:700">{{ stats.expiring_1d }}</div>
    </div>
  </div>
  <div class="col">
    <div class="card">
      <div class="muted">Expiring 3d</div>
      <div style="font-size:28px; font-weight:700">{{ stats.expiring_3d }}</div>
    </div>
  </div>
</div>

<div class="card">
  <h3>Cron</h3>
  <form action="/admin/cron" method="post">
    <button class="btn ok" type="submit">Run cron now</button>
    <span class="muted">(idempotent)</span>
  </form>
</div>

<div class="card">
  <h3>Sync (SQLite ↔ Supabase)</h3>
  <div class="row">
    <div class="col">
      <form action="/admin/sync/push_users" method="post">
        <button class="btn" type="submit">Push users → Supabase</button>
      </form>
    </div>
    <div class="col">
      <form action="/admin/sync/pull_users" method="post">
        <button class="btn" type="submit">Pull users ← Supabase</button>
      </form>
    </div>
    <div class="col">
      <form action="/admin/sync/push_all" method="post">
        <button class="btn ok" type="submit">Push ALL tables → Supabase</button>
      </form>
    </div>
    <div class="col">
      <form action="/admin/sync/pull_all" method="post">
        <button class="btn warn" type="submit">Pull ALL tables ← Supabase</button>
      </form>
    </div>
  </div>
  <div class="muted" style="margin-top:8px">Requires DATABASE_URL configured for Supabase. Push copies local SQLite users to Supabase. Pull copies Supabase users into local SQLite.</div>
</div>

<div class="card">
  <h3>SQLite DB (Download / Upload)</h3>
  <div class="row">
    <div class="col">
      <a class="btn" href="/admin/db/download">Download bot.db</a>
    </div>
    <div class="col">
      <form action="/admin/db/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="file" accept=".db,.sqlite" required>
        <button class="btn warn" type="submit">Upload & Replace</button>
      </form>
    </div>
  </div>
  <div class="muted" style="margin-top:8px">Upload replaces local bot.db (backup .bak created).</div>
</div>
{% endblock %}
